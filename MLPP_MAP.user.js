// ==UserScript==
// @name         MLPP MAP
// @namespace    http://tampermonkey.net/
// @version      2024-05-02-BETA
// @description  try to take over the PP!
// @author       Artak : beta testers Sallbet
// @match      *://pixelplanet.fun/*
// @match      *://fuckyouarkeros.fun/*
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhElEQVR4nO2UQQ7AIAgE+dd83N/Z9NDEQyOUFqkJm3jS4AALIgGi9X6eiNh7ArAaiCwAlI+u+zAY/g4w6lMQHMGWA5BderQ3DAa5G6GZgWbBzZnjANDAHmUuDvJ0AIsKgGpBc3oJg7Pf7gifa40AIZnPFAqAY9cXANWCVibsm45hSRbrAHWNRoX99Ul3AAAAAElFTkSuQmCC
// @grant        none
// ==/UserScript==
(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};async function e(t,e){const n=await Promise.all(t.map((async t=>{const n=await async function(t,e){return e[0]>=t.x&&e[1]>=t.y&&e[0]<=t.x+t.width&&e[1]<=t.y+t.height}(t,e);if(n)return t})));return n.filter((t=>void 0!==t))}function n(t){return"object"==typeof t&&(!!t.dispatch&&(!!t.getState&&!!t.subscribe))}function o(t){if(0!==t.tag||!t.child)return;if(10!==t.child.tag)return;if(!t.child.memoizedProps)return;const e=t.child.memoizedProps.value?.store;if(!n(e))return;const o=t.memoizedProps?.store;return n(o)&&e===o?o:void 0}function a(){const t=document.getElementById("app");if(!t)throw new Error("Couldn't find React root container");const e=function(t){const e=Object.keys(t).filter((t=>t.startsWith("__reactContainer")))[0];if(!e)throw new Error("couldn't find internal react root");let n=t[e];for(;n.child;){const t=o(n);if(t)return t;n=n.child}}(t);if(!e)throw new Error("Couldn't find Redux store");return e}function i(t){return r().getState().canvas[t]}function r(){return a()}function s(t){r().dispatch(t)}async function l(){return i("hover")?i("hover"):i("view")}t.d({},{_e:()=>j,Tx:()=>D,v2:()=>N,yn:()=>T,R6:()=>R,C5:()=>P,n:()=>B,LI:()=>z});let c=0;async function d(t,e){if(c>0)return;c++;const n=256,{x:o,y:a}=t,[r,s]=e,l=i("canvasSize"),d=l/2,h=t.errors.getContext("2d"),u=document.createElement("canvas"),g=u.getContext("2d");u.width=256,u.height=256;const m=Math.floor((r-o)/n)*n-T.Radius*n,w=Math.floor((s-a)/n)*n-T.Radius*n,f=[];for(let t=m;t<=m+2*T.Radius*n;t+=n)for(let e=w;e<=w+2*T.Radius*n;e+=n)f.push([o+t,a+e]);const p=f.map((e=>async function(t){const e=i("canvasSize")/2;return[Math.floor((t[0]+e)/256),Math.floor((t[1]+e)/256)]}(e).then((async e=>{if(e[0]<0&&e[1]>l/256&&e[0]<0&&e[1]>l/256)return;const[n,r]=e;if(!t.chunks.some((([t,e])=>t===256*n-d&&e===256*r-d))){t.chunks.push([256*n-d,256*r-d]);const[s,l,c]=await async function(t){const e=await fetch("https://fuckyouarkeros.fun/chunks/"+i("canvasId")+"/"+t[0]+"/"+t[1]+".bmp"),n=await e.arrayBuffer(),o=new Uint8Array(n),a=new Uint8Array([...o,...new Uint8Array(65536-o.length).fill(0)]);let r=[];const s=i("palette").rgb;a.forEach((t=>{const e=3*t;r.push(s[e],s[e+1],s[e+2],255)}));const l=new ImageData(new Uint8ClampedArray(r),256,256),c=i("canvasSize")/2;return[l,256*t[0]-c,256*t[1]-c]}(e);g.clearRect(0,0,u.width,u.height);const m=await async function(t,e,n,o,a){t.drawImage(e,n,o,256,256,0,0,256,256);const i=t.getImageData(0,0,256,256).data,r=a.data;for(let t=0;t<i.length;t+=4)0===i[t+3]?(r[t]=0,r[t+1]=0,r[t+2]=0,r[t+3]=0):i[t+0]===r[t+0]&&i[t+1]===r[t+1]&&i[t+2]===r[t+2]?(r[t]=0,r[t+1]=255,r[t+2]=0,r[t+3]=255):(r[t]=255,r[t+1]=0,r[t+2]=0,r[t+3]=255);return new ImageData(r,256,256)}(g,t.data,-1*(o-l),-1*(a-c),s);h.putImageData(m,-1*(o-l),-1*(a-c))}}))));await Promise.all(p),c--}function h(t,e,n,[o,a],i,r){const s=256*e-i+o-256*Math.floor(o/256)-t.x,l=256*n-i+Math.floor(o/256)-t.y;a*=3,t.ChekAndSet(s,l,r[a+0],r[a+1],r[a+2])}class u{constructor(t,e,n,o,a,i){const r=document.createElement("canvas");r.width=a,r.height=i,this.name=t,this.data=o,this.x=e,this.y=n,this.width=a,this.height=i,this.errors=r,this.chunks=[],this.ctxErr=this.errors.getContext("2d"),this.ctxData=this.data.getContext("2d"),this.RealData=this.GetImageData(this.data),this.data.style="width: 100%; height: 21.8vw; image-rendering: pixelated;",this.errors.style="width: 100%; height: 21.8vw; image-rendering: pixelated;"}GetImageData(t){return t.getContext("2d").getImageData(0,0,this.width,this.height)}GetIndex(t,e){return t<0?t=0:t>this.width&&(t=this.width),e<0?e=0:e>this.height&&(e=this.height),this.width*e+t}GetPixColorData(t,e){return Array.from(Array(4),((n,o)=>t.data[4*e+o]))}SetPixdata(t,e,n){this.ctxErr.fillStyle=n,this.ctxErr.fillRect(t,e,1,1)}ChekAndSet(t,e,n,o,a){const i=this.GetPixColorData(this.RealData,this.GetIndex(t,e));0!=i[3]&&(i[0]>n-40&&i[1]===o&&i[2]===a?this.SetPixdata(t,e,"rgba(0, 255, 0, 255)"):this.SetPixdata(t,e,"rgba(255, 0, 0, 255)"))}}class g{constructor(t){this.images=[],this.Canvass=null==t?[]:t,this.loadNewImages=!1,this.OverLayStatus="true"===localStorage.getItem("OverLayStatus")||!1,this.Errors="true"===localStorage.getItem("Errors")||!1,this.AutoColor="true"===localStorage.getItem("AutoColor")||!1,this.glow="true"===localStorage.getItem("glow")||!1,this.Radius=1,this.viewCords=[]}}function m([t,e,n,o]){if(255!==o)return;const a=i("palette").rgb;for(let o=0;o<a.length;o+=3)a[o]===t&&a[o+1]===e&&a[o+2]===n&&s({type:"SELECT_COLOR",color:o/3})}function w(t){t.shiftKey?(console.log("\u041a\u043b\u0430\u0432\u0438\u0448\u0430 Shift \u043d\u0430\u0436\u0430\u0442\u0430"),s({type:"s/SET_HOLD_PAINT",value:0,immediate:0})):console.log("\u041a\u043b\u0430\u0432\u0438\u0448\u0430 Shift \u043d\u0435 \u043d\u0430\u0436\u0430\u0442\u0430")}function f(t){t.forEach((t=>{let e=function(t,e){let n=document.createElement(t);for(let t in e)n.setAttribute(t,e[t]);return document.querySelector(".scrollable-content").append(n),n}("a",{style:"overflow: hidden; width: 24vw; height: 24vw; display: block;",class:"position",href:document.location.href.split(",")[0]+","+Math.round(t.x+t.width/2)+","+Math.round(t.y+t.height/2)+",0"});const n=document.createElement("p");n.textContent=" "+t.name,n.className="itemText",e.appendChild(n),e.appendChild(t.data)}))}function p(){var t,e;(t=document.createElement("style")).textContent="\n    .container {\n      position: relative;\n      top: 25dvh;\n    }\n\n    .hidden-element {\n      position: absolute;\n      left: -25vw;\n      width: 25vw;\n      height: 50vh;\n      background-color: rgba(0, 0, 0, 0.3);\n      transition: all 0.5s ease;\n      overflow: auto;\n    }\n\n    .scrollable-content {\n      padding: 10px;\n    }\n\n    .hidden-btn {\n      z-index: 1;\n      position: absolute;\n      left: 0%;\n      background-color: lightblue;\n      transition: all 0.5s ease;\n    }\n\n    .show-menu {\n      left: 0;\n    }\n\n    .show-btn {\n      left: 25vw;\n    }\n\n    .toggle-btn {\n      width: 20px;\n      height: 50vh;\n      position: absolute;\n      background-color: black;\n      color: white;\n      border: none;\n      padding: 20px;\n      cursor: pointer;\n      z-index: 0;\n      box-shadow: 20px 0px 20px -11px rgb(0 123 255);\n\n      writing-mode: vertical-rl;\n      text-orientation: mixed;\n\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    /* \u0421\u043a\u0440\u044b\u0442\u044c \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 */\n    .hidden-element::-webkit-scrollbar {\n      display: none;\n    }\n\n    /* \u0421\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0442\u0440\u0435\u043a\u0430 \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 */\n    .hidden-element::-webkit-scrollbar-track {\n      background-color: #f1f1f1;\n    }\n\n    /* \u0421\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 */\n    .hidden-element::-webkit-scrollbar-thumb {\n      background-color: #888;\n      border-radius: 10px;\n    }\n\n    /* \u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0446\u0432\u0435\u0442\u0430 \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 \u043f\u0440\u0438 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0438\u0438 */\n    .hidden-element::-webkit-scrollbar-thumb:hover {\n      background-color: #555;\n    }\n\n    .position{\n      display: block;\n      height: 4dvh;\n      background-color: black;\n      margin-bottom: 1dvh;\n      white-space: nowrap; /* \u0417\u0430\u043f\u0440\u0435\u0442 \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u0442\u0435\u043a\u0441\u0442\u0430 \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 */\n      overflow: hidden; /* \u0421\u043a\u0440\u044b\u0442\u0438\u0435 \u0447\u0430\u0441\u0442\u0438 \u0442\u0435\u043a\u0441\u0442\u0430, \u0432\u044b\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u0437\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 */\n      text-overflow: ellipsis; /* \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u043d\u043e\u0433\u043e\u0442\u043e\u0447\u0438\u044f \u0432 \u043a\u043e\u043d\u0446\u0435 \u0442\u0435\u043a\u0441\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b\u0445\u043e\u0434\u0438\u0442 \u0437\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 */\n      transition: all 0.5s ease;\n    }\n\n    .itemText{\n      margin: 0;\n      padding: 5px;\n      text-align: center;\n      border-bottom: solid;\n      border-bottom-width: 1px;\n    }\n  ",document.head.appendChild(t),(e=document.createElement("div")).classList.add("container"),e.innerHTML='\n    <button class="toggle-btn hidden-btn"> \u2206 - \u2207 </button>\n    <div class="hidden-element">\n        <div class="scrollable-content">\n          \n       </div>\n    </div>\n  ',document.body.appendChild(e);let n=0;document.querySelector(".toggle-btn").addEventListener("click",(function(){document.querySelector(".hidden-element").classList.toggle("show-menu"),document.querySelector(".toggle-btn").classList.toggle("show-btn")})),setInterval((()=>{T.images.length!=n&&(n=T.images.length,console.log("\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b:",T.images.length),function(){for(var t=document.querySelector(".scrollable-content");t.firstChild;)t.removeChild(t.firstChild)}(),f(T.images))}),1e3)}function v(t){return document.getElementById(t)}async function y(t,e,n){try{const o=T.OverLayStatus?window.innerWidth:e,a=T.OverLayStatus?window.innerHeight:n,i=`${"cal"==t&&T.glow?"glow":""}  ${T.OverLayStatus?"notClickable":""}`;B("CANVAS",{width:o,height:a,id:t,className:i,style:"\n            image-rendering: pixelated;\n            position: absolute;\n            right: 0px;\n        "}),T.Canvass.push([v(t),v(t).getContext("2d")])}catch(t){D(t,"crateCanvas")}}function b(t){!async function(t,e,n){let o=70,a="resizeCanvass";t+=n[0],e+=n[1];try{for(let n in T.Canvass)t<o||e<o?(R("the width or height is too small. --\x3e>|| ",a),T.Canvass[n][0].width=t<=o?o:t,T.Canvass[n][0].height=e<=o?o:e):t>=window.innerWidth-o||e>=window.innerHeight-o?(R("the width or height is too big. --\x3e>|| ",a),T.Canvass[n][0].width=t>=window.innerWidth-o?window.innerWidth-o:t,T.Canvass[n][0].height=e>=window.innerHeight-o?window.innerHeight-o:e):(T.Canvass[n][0].width=t,T.Canvass[n][0].height=e),T.Canvass[n][1].imageSmoothingEnabled=!1;localStorage.setItem("size",[T.Canvass[0][0].width,T.Canvass[0][0].height])}catch(t){D(t,a)}}(window.innerWidth-t.pageX,t.pageY,z)}function x(){const t=document.getElementById("menu");t.classList.contains("hidden")||(t.classList.toggle("hidden"),setTimeout((()=>{t.style.display="none"}),300))}function C(){var t;(t=document.createElement("style")).textContent="\n  #menu-toggle {\n    position: fixed;\n    top: 16px;\n    left: 35vw;\n    z-index: 9997;\n    width: 30vw;\n    height: 38px;\n    color: white;\n    background-color: #000000f5;\n    border: 2px solid rgb(0 0 0);\n    box-shadow: 0px -5px 20px rgb(0 123 255);\n    transition: all 0.4s ease-in-out;\n  }\n\n  #menu-toggle:hover {\n    background-color: #00336acc;\n  }\n\n  #menu {\n    position: fixed;\n    top: 54px;\n    left: 35vw;\n    width: calc(30vw - 4px);\n    border: 2px solid black;\n    /* box-shadow: 0px 9px 20px rgb(0 123 255); */\n    z-index: 9998;\n    overflow: hidden;\n    opacity: 0;\n    display: none;\n    transition: all 0.2s ease-in-out;\n    height: 0;\n    flex-wrap: wrap;\n    background-color: #00000063;\n  }\n\n  #menu.hidden {\n      opacity: 0;\n      height: 0;\n  }\n\n  #menu:not(.hidden) {\n    opacity: 1;\n    height: 13vh;\n  }\n\n  .map_button {\n    background-color: #0506077d;;\n    color: #fff;\n    font-size: 16px;\n    border: solid;\n    border-color: black;\n    cursor: pointer;\n    flex-basis: calc(25%);\n    flex-grow: 0;\n    overflow: hidden;\n    transition: all 0.2s ease-in-out;\n  }\n\n  .cooldownbox{\n    top: 59px;\n    left: calc(44vw - 1px);\n    visibility: visible;\n    opacity: 0.3;\n    width: 85px;\n    margin-left: 0;\n    margin-right: 0;\n    padding: 0;\n  }\n\n  .notifybox {\n    opacity: 0.3;\n    top: 62px;\n    left: 85px;\n    visibility: visible;\n    width: 80px;\n  }\n\n  .on {\n    background-color: #007fff82;\n  }\n  ",document.head.appendChild(t),function(){try{var t=document.createElement("div");t.classList.add("container"),t.innerHTML=`\n    <button id="menu-toggle">\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e</button>\n    <div id="menu" class="hidden">\n        <button class="map_button MAPcolor ${"true"==localStorage.getItem("AutoColor")?"on":""}">color</button>\n        <button class="map_button MAPerr ${"true"==localStorage.getItem("Errors")?"on":""}">err</button>\n        <button class="map_button MAPoverlay ${"true"==localStorage.getItem("OverLayStatus")?"on":""}">overlay</button>\n        <button class="map_button MAPglow ${"true"==localStorage.getItem("glow")?"on":""}">glow</button>\n    </div>\n    `,document.body.appendChild(t)}catch(t){alert(t+"in LoadHTML"),console.error(t)}}(),document.getElementsByClassName("viewport")[0].addEventListener("mousemove",x),document.getElementById("menu-toggle").addEventListener("click",(()=>{!function(){const t=document.getElementById("menu");t.style.display="flex",setTimeout((()=>{t.classList.toggle("hidden"),t.classList.contains("hidden")&&setTimeout((()=>{t.style.display="none"}),300)}),10)}()}));document.querySelectorAll(".map_button").forEach((t=>{t.addEventListener("click",(function(){const t=this.classList[1];switch(console.log(`\u041a\u043d\u043e\u043f\u043a\u0430 \u0441 \u043a\u043b\u0430\u0441\u0441\u043e\u043c ${t} \u0431\u044b\u043b\u0430 \u043d\u0430\u0436\u0430\u0442\u0430`),t){case"MAPcolor":T.AutoColor=!T.AutoColor,localStorage.setItem("AutoColor",T.AutoColor),document.getElementsByClassName("MAPcolor")[0].classList.toggle("on");break;case"MAPerr":T.Errors=!T.Errors,localStorage.setItem("Errors",T.Errors),document.getElementsByClassName("MAPerr")[0].classList.toggle("on");break;case"MAPoverlay":!function(){let t=localStorage.getItem("size").split(",")?localStorage.getItem("size").split(","):[256,256],e=0,n=0;T.OverLayStatus=!T.OverLayStatus,localStorage.setItem("OverLayStatus",T.OverLayStatus),document.getElementsByClassName("MAPoverlay")[0].classList.toggle("on"),T.OverLayStatus?(e=window.innerWidth,n=window.innerHeight):(e=t[0],n=t[1]),T.Canvass.forEach((t=>{t[0].classList.toggle("notClickable"),t[0].width=e,t[0].height=n,t[1].imageSmoothingEnabled=!1}))}();break;case"MAPglow":!function(){const t=document.getElementById("cal"),e=!t.classList.contains("glow");t.classList.toggle("glow"),localStorage.setItem("glow",e),document.getElementsByClassName("MAPglow")[0].classList.toggle("on")}()}}))}))}const E="TheElderFallouts",S="wwbtp";async function L(){const t=await async function(){try{const t=await fetch("https://api.github.com/repos/"+E+"/"+S+"/commits");if(!t.ok)throw new Error("\u041e\u0448\u0438\u0431\u043a\u0430 HTTP: "+t.status);return await t.json()}catch(t){return console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432:",t.message),[]}}();if(Array.isArray(t))return console.log(t[0].sha),t[0].sha;console.error("\u041e\u0442\u0432\u0435\u0442 \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u043a\u043e\u043c\u043c\u0438\u0442\u043e\u0432:",t)}function I(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}async function k(t,e,n){const o=await async function(t,e){try{return new Promise((n=>{let o=t+e,a=document.createElement("img");a.crossOrigin="Anonymous",a.onload=function(){let t=this.width,e=this.height,o=document.createElement("canvas");o.width=this.width,o.height=this.height,o.getContext("2d").drawImage(a,0,0),n([o,t,e])},a.src=o}))}catch(t){D(t,"getNewImage")}}(I([104,116,116,112,115,58,47,47,114,97,119,46,103,105,116,104,117,98,117,115,101,114,99,111,110,116,101,110,116,46,99,111,109,47,84,104,101,69,108,100,101,114,70,97,108,108,111,117,116,115,47,119,119,98,116,112,47,109,97,105,110,47,80,80,47])+n+"/",t[e].name);T.images.push(new u(t[e].name,t[e].x,t[e].y,...o)),v("loadProgress").value=v("loadProgress").value+1,v("loadProgress").value==v("loadProgress").max&&v("loadProgress").remove()}async function A(){const t=await L();var e;T.loadNewImages=localStorage.getItem("commit")!=t&&(e=t,localStorage.setItem("commit",e),!0),async function(t){try{let e=await N(I([104,116,116,112,115,58,47,47,114,97,119,46,103,105,116,104,117,98,117,115,101,114,99,111,110,116,101,110,116,46,99,111,109,47,84,104,101,69,108,100,101,114,70,97,108,108,111,117,116,115,47,119,119,98,116,112,47,109,97,105,110,47,80,80,47,116,101,109,112,108,97,116,101,115,47])+t+".json");B("progress",{id:"loadProgress",max:Object.keys(e).length,value:"0",style:"position: absolute;left: 0px;right: 0px;margin: 0px auto;top: 0px;display: block;padding: 11px;accent-color: lime;"});for(let n in e)k(e,n,t)}catch(t){console.error(t),D(t,"LOADAllImages")}}(i("canvasIdent")),pixelPlanetEvents.addListener("setviewcoordinates",(t=>T.viewCords=t)),document.addEventListener("mousemove",j),document.addEventListener("keydown",w),T.Canvass[T.Canvass.length-1][0].onmousedown=t=>{document.removeEventListener("mousemove",j),z=[],z[0]=T.Canvass[0][0].width-(window.innerWidth-t.pageX),z[1]=T.Canvass[0][0].height-t.pageY,document.addEventListener("mousemove",b),document.onmouseup=async()=>{document.removeEventListener("mousemove",b),document.addEventListener("mousemove",j)}}}let P=["mine","cal"],M=1,O=[],T=new g,z=[];function D(t,e){console.error(t.message+"  ||--\x3e "+e),alert(t+"  ||--\x3e "+e)}function R(t,e){console.warn(t.message+"  ||--\x3e "+e)}function B(t,e){let n=document.createElement(t);for(let t in e)n[t]=e[t];document.body.append(n)}async function N(t){try{return new Promise((e=>{fetch(t).then((t=>{e(t.json())}))}))}catch(t){D(t,"GetTeampletList")}}function _(){return M}function G(t){try{return Array.from([t.width/2,t.height/2],(t=>t))}catch(t){D(t,"GetObjectMid")}}function H(t,e,n,o,a){try{if(!(t&&e&&n.length))return void D("EMPTY","Draw");T.OverLayStatus?e[1].drawImage(t,...Array.from(G(e[0]),((t,e)=>(n[e]-a[e])*_()+t)),...Array.from(o,((t,e)=>t*_()))):e[1].drawImage(t,...Array.from(G(e[0]),((t,e)=>Math.round(n[e]-a[e])*_()+t-_()/2)),...Array.from(o,((t,e)=>t*_())))}catch(t){D(t,"Draw")}}async function j(){try{const t=await l();let n=T.OverLayStatus?T.viewCords:t;const o=await e(T.images,n);if(T.Canvass[0][1].clearRect(0,0,T.Canvass[0][0].width,T.Canvass[0][0].height),T.Canvass[0][1].fillStyle="rgba(0, 0, 0, 0.5)",T.Canvass[0][1].fillRect(0,0,T.Canvass[0][0].width,T.Canvass[0][0].height),T.Canvass[1][1].clearRect(0,0,T.Canvass[0][0].width,T.Canvass[0][0].height),T.images.forEach((t=>H(t.data,T.Canvass[0],[t.x,t.y],[t.width,t.height],n))),T.Errors){T.images.forEach((t=>H(t.errors,T.Canvass[1],[t.x,t.y],[t.width,t.height],n)));for(let t of o)d(t,n)}if(T.AutoColor)for(let e of o)t[0]==O[0]&&t[1]==O[1]||(O=t,r().getState().gui.mute||s({type:"s/TGL_MUTE"}),m(e.GetPixColorData(e.RealData,e.GetIndex(t[0]-e.x,t[1]-e.y))))}catch(t){console.error(t),D(t,"DrawAllTemp")}}window.pixelPlanetEvents.addListener("setscale",((t,e)=>{M=t,j()})),window.registerPixelUpdates(((t,n,o)=>async function(t,n,o){const a=await l(),r=i("canvasSize")/2,s=i("palette").rgb,c=await e(T.images,a);for(let e of c)o.forEach(((a,i)=>{h(e,t,n,o[i],r,s)}));DrawAllTemp()}(t,n,o))),window.addEventListener("load",(function(){setTimeout((async()=>{localStorage.size||localStorage.setItem("size",[500,300]),await async function(){try{const t=localStorage.getItem("size").split(",")?localStorage.getItem("size").split(","):[256,256];for(let e in P)y(P[e],...t),T.Canvass[e][1].imageSmoothingEnabled=!1}catch(t){D(t,"crateAllCanvass")}}(),A(),p(),C();const t=document.createElement("style");t.innerHTML="\n        @keyframes blink {\n            0% { opacity: 0.0; }\n            50% { opacity: 1.0; }\n            100% { opacity: 0.0; }\n        }\n\n        #mine {\n            box-shadow: -1px 1px 20px 0 rgb(0 123 255);\n        }\n\n        .glow {\n            animation: blink 5s infinite;\n        }\n        \n        #mine:not(.notClickable){\n            border-style: unset;\n            border-width: 1px;\n        }\n\n        #cal:not(.notClickable){\n            border-style: unset;\n            border-width: 1px;\n        }\n        .notClickable{\n            pointer-events: none;\n            opacity: 0.4;\n            border: none;\n            box-shadow: none;\n        }\n        ",(document.head||document.getElementsByTagName("head")[0]).appendChild(t);let e=i("canvasIdent");setInterval((()=>{e!==i("canvasIdent")&&(document.removeEventListener("mousemove",b),document.removeEventListener("mousemove",j),T=new g(T.Canvass),e=i("canvasIdent"),A())}),1e3)}),2e3)}))})();



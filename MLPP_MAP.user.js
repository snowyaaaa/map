// ==UserScript==
// @name         MLPP MAP
// @namespace    http://tampermonkey.net/
// @version      1.2
// @description  HUH.....
// @author       Artak : beta testers Sallbet
// @match      *://pixelplanet.fun/*
// @match      *://fuckyouarkeros.fun/*
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhElEQVR4nO2UQQ7AIAgE+dd83N/Z9NDEQyOUFqkJm3jS4AALIgGi9X6eiNh7ArAaiCwAlI+u+zAY/g4w6lMQHMGWA5BderQ3DAa5G6GZgWbBzZnjANDAHmUuDvJ0AIsKgGpBc3oJg7Pf7gifa40AIZnPFAqAY9cXANWCVibsm45hSRbrAHWNRoX99Ul3AAAAAElFTkSuQmCC
// @grant        none
// ==/UserScript==
(()=>{"use strict";var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};async function n(e,n){const t=await Promise.all(e.map((async e=>{const t=await async function(e,n){return n[0]>=e.x&&n[1]>=e.y&&n[0]<=e.x+e.width&&n[1]<=e.y+e.height}(e,n);if(t)return e})));return t.filter((e=>void 0!==e))}function t(e){return"object"==typeof e&&(!!e.dispatch&&(!!e.getState&&!!e.subscribe))}function o(e){if(0!==e.tag||!e.child)return;if(10!==e.child.tag)return;if(!e.child.memoizedProps)return;const n=e.child.memoizedProps.value?.store;if(!t(n))return;const o=e.memoizedProps?.store;return t(o)&&n===o?o:void 0}function i(){const e=document.getElementById("app");if(!e)throw new Error("Couldn't find React root container");const n=function(e){const n=Object.keys(e).filter((e=>e.startsWith("__reactContainer")))[0];if(!n)throw new Error("couldn't find internal react root");let t=e[n];for(;t.child;){const e=o(t);if(e)return e;t=t.child}}(e);if(!n)throw new Error("Couldn't find Redux store");return n}function a(e){return s().getState().canvas[e]}function s(){return i()}function r(e){s().dispatch(e)}async function l(){return G.mobile?G.TouchCords:a("hover")?a("hover"):a("view")}e.d({},{_e:()=>J,Tx:()=>W,v2:()=>U,yn:()=>G,R6:()=>V,C5:()=>j,n:()=>H,LI:()=>Y});let c=0;async function d(e,n){if(c>0)return;c++;const t=256,{x:o,y:i}=e,[s,r]=n,l=a("canvasSize"),d=l/2,u=e.errors.getContext("2d"),h=document.createElement("canvas"),m=h.getContext("2d");h.width=t,h.height=t;const g=Math.floor((s-o)/t)*t-(G.Radius<<8),p=Math.floor((r-i)/t)*t-(G.Radius<<8),v=[];for(let e=g;e<=g+2*(G.Radius<<8);e+=t)for(let n=p;n<=p+2*(G.Radius<<8);n+=t)v.push([o+e,i+n]);const w=v.map((async n=>{const[t,s]=await async function(e){const n=a("canvasSize")>>1;return[e[0]+n>>8,e[1]+n>>8]}(n);if(!(t<0||s<0||t>l>>8||s>l>>8||e.chunks.some((([e,n])=>e===(t<<8)-d&&n===(s<<8)-d)))){e.chunks.push([(t<<8)-d,(s<<8)-d]);const[n,r,l]=await async function(e,n){const t=await fetch(`https://fuckyouarkeros.fun/chunks/${a("canvasId")}/${e}/${n}.bmp`),o=await t.arrayBuffer(),i=new Uint8Array(o),s=new Uint8Array(65536);s.set(i);const r=a("palette").rgb,l=new Uint8ClampedArray(262144);for(let e=0;e<s.length;e++){const n=3*s[e],t=e<<2;l[t]=r[n],l[t+1]=r[n+1],l[t+2]=r[n+2],l[t+3]=255}const c=new ImageData(l,256,256),d=a("canvasSize")>>1;return[c,(e<<8)-d,(n<<8)-d]}(t,s);m.clearRect(0,0,h.width,h.height);const c=await async function(e,n,t,o,i){e.drawImage(n,t,o,256,256,0,0,256,256);const a=e.getImageData(0,0,256,256).data,s=i.data;for(let e=0;e<a.length;e+=4)0===a[e+3]?(s[e]=0,s[e+1]=0,s[e+2]=0,s[e+3]=0):a[e+0]===s[e+0]&&a[e+1]===s[e+1]&&a[e+2]===s[e+2]?(s[e]=0,s[e+1]=50,s[e+2]=0,s[e+3]=255):(s[e]=255,s[e+1]=0,s[e+2]=0,s[e+3]=255);return new ImageData(s,256,256)}(m,e.data,-1*(o-r),-1*(i-l),n);u.putImageData(c,-1*(o-r),-1*(i-l))}}));await Promise.all(w),c--}function u(e,n,t,[o,i],a,s){const r=(n<<8)-a+(255&o)-e.x,l=(t<<8)-a+(o>>8)-e.y;i*=3,e.ChekAndSet(r,l,s[i+0],s[i+1],s[i+2])}function h(e,n){let t=document.getElementsByClassName("viewport")[0];if(t){const o=new TouchEvent("touchstart",{bubbles:!0,cancelable:!0,touches:[new Touch({identifier:Date.now(),target:t,clientX:e,clientY:n,screenX:e,screenY:n,pageX:e,pageY:n})]});t.dispatchEvent(o);const i=new TouchEvent("touchmove",{bubbles:!0,cancelable:!0,touches:[new Touch({identifier:Date.now(),target:t,clientX:e,clientY:n,screenX:e,screenY:n,pageX:e,pageY:n})]});t.dispatchEvent(i);const a=new TouchEvent("touchend",{bubbles:!0,cancelable:!0,touches:[],changedTouches:[new Touch({identifier:Date.now(),target:t,clientX:e,clientY:n,screenX:e,screenY:n,pageX:e,pageY:n})]});t.dispatchEvent(a)}}function m([e,n,t,o]){if(255!==o)return;const i=a("palette").rgb;for(let o=0;o<i.length;o+=3)i[o]===e&&i[o+1]===n&&i[o+2]===t&&r({type:"SELECT_COLOR",color:o/3})}function g(e){e.shiftKey?(console.log("\u041a\u043b\u0430\u0432\u0438\u0448\u0430 Shift \u043d\u0430\u0436\u0430\u0442\u0430"),r({type:"s/SET_HOLD_PAINT",value:0,immediate:0})):console.log("\u041a\u043b\u0430\u0432\u0438\u0448\u0430 Shift \u043d\u0435 \u043d\u0430\u0436\u0430\u0442\u0430")}function p(e){let n="";for(let t=0;t<e.length;t++)n+=String.fromCharCode(e[t]);return n}function v(e){return document.getElementById(e)}async function w(e,n,t){!async function(e,n,t,o){try{return new Promise((i=>{let a=e+n,s=document.createElement("img");s.crossOrigin="Anonymous",s.onload=function(){let e=this.width,n=this.height;v("loadProgress").value=v("loadProgress").value+1,v("loadProgress").value==v("loadProgress").max&&(v("loadProgress").style="position: absolute;left: 0px;right: 0px;margin: 0px auto;top: 0px;display: none;padding: 11px;accent-color: lime;"),G.addImages(new M(t[o].name,t[o].x,t[o].y,...[null,e,n],s))},s.src=a}))}catch(e){W(e,"getNewImage")}}(p([104,116,116,112,115,58,47,47,114,97,119,46,103,105,116,104,117,98,117,115,101,114,99,111,110,116,101,110,116,46,99,111,109,47])+G.fraction+p([47,119,119,98,116,112,47,114,101,102,115,47,104,101,97,100,115,47,109,97,105,110,47,80,80,47])+t+"/",e[n].name,e,n)}async function f(e,n){try{let t;G.images=[],G.LastRadiusCheck=n,t=await U(p([104,116,116,112,115,58,47,47,114,97,119,46,103,105,116,104,117,98,117,115,101,114,99,111,110,116,101,110,116,46,99,111,109,47])+G.fraction+p([47,119,119,98,116,112,47,114,101,102,115,47,104,101,97,100,115,47,109,97,105,110,47,80,80,47,116,101,109,112,108,97,116,101,115,47])+e+p([46,106,115,111,110])),G.Templates=t;const o=Object.values(t).filter((e=>function(e,n,t){console.log(e,n,t);const o=e.x+e.width/2,i=e.y+e.height/2,a=Math.abs(n[0]-o),s=Math.abs(n[1]-i);if(a>e.width/2+t||s>e.height/2+t)return!1;if(a<=e.width/2&&s<=e.height/2)return!0;const r=a-e.width/2,l=s-e.height/2;return r*r+l*l<=t*t}(e,n,2*G.CheckRadius)));if(0==o.length)return;const i=o.reduce(((e,n,t)=>(e[t+1]=n,e)),{});let a=v("loadProgress");a?(a.value=0,a.max=o.length,a.style="position: absolute;left: 0px;right: 0px;margin: 0px auto;top: 0px;display: block;padding: 11px;accent-color: lime;"):H("progress",{id:"loadProgress",max:o.length,value:"0",style:"position: absolute;left: 0px;right: 0px;margin: 0px auto;top: 0px;display: block;padding: 11px;accent-color: lime;"});for(let n in i)w(i,n,e)}catch(e){console.error(e),W(e,"LOADAllImages")}}async function b(e,n,t){try{const o=G.OverLayStatus?window.innerWidth:n,i=G.OverLayStatus?window.innerHeight:t,a=`${"cal"==e&&G.glow?"glow":""}  ${G.OverLayStatus?"notClickable":""}`;H("CANVAS",{width:o,height:i,id:e,className:a,style:"\n            image-rendering: pixelated;\n            position: absolute;\n            right: 0px;\n        "}),G.Canvass.push([v(e),v(e).getContext("2d")])}catch(e){W(e,"crateCanvas")}}async function y(e,n,t){let o=70,i="resizeCanvass";e+=t[0],n+=t[1];try{for(let t in G.Canvass)e<o||n<o?(V("the width or height is too small. --\x3e>|| ",i),G.Canvass[t][0].width=e<=o?o:e,G.Canvass[t][0].height=n<=o?o:n):e>=window.innerWidth-o||n>=window.innerHeight-o?(V("the width or height is too big. --\x3e>|| ",i),G.Canvass[t][0].width=e>=window.innerWidth-o?window.innerWidth-o:e,G.Canvass[t][0].height=n>=window.innerHeight-o?window.innerHeight-o:n):(G.Canvass[t][0].width=e,G.Canvass[t][0].height=n),G.Canvass[t][1].imageSmoothingEnabled=!1;G.SaveObjectMid(),localStorage.setItem("size",[G.Canvass[0][0].width,G.Canvass[0][0].height])}catch(e){W(e,i)}}function x(e){if(e.pageX&&e.pageY)y(window.innerWidth-e.pageX,e.pageY,Y);else{const n=e.touches[0];y(window.innerWidth-n.clientX,n.clientY,Y)}}function C(e){Y=[],Y[0]=G.Canvass[0][0].width-(window.innerWidth-e.pageX),Y[1]=G.Canvass[0][0].height-e.pageY,G.mobile?(document.getElementsByClassName("viewport")[0].removeEventListener("touchmove",J),document.addEventListener("touchmove",x),document.addEventListener("touchend",E)):(document.removeEventListener("mousemove",J),document.addEventListener("mousemove",x),document.onmouseup=E)}function E(){G.mobile?(document.getElementById("fullscreenDiv")&&document.getElementById("fullscreenDiv").remove(),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",E)):(document.removeEventListener("mousemove",x),document.addEventListener("mousemove",J))}const k=function(e,n){let t,o;return function(){const i=this,a=arguments;o?(clearTimeout(t),t=setTimeout((function(){Date.now()-o>=n&&(e.apply(i,a),o=Date.now())}),n-(Date.now()-o))):(e.apply(i,a),o=Date.now())}}((function(e){S(e)}),10);function S(e){const{touches:[{clientX:n,clientY:t}]}=e,{Scale:o,viewCords:i,TouchCords:a,RealTouchCords:s}=G,[r,l]=i,c=window.innerWidth/2,d=window.innerHeight/2,u=c/o*-1+n/o-(Math.floor(r)-r),h=d/o*-1+t/o-(Math.floor(l)-l),m=Math.floor(u)+Math.floor(r),g=Math.floor(h)+Math.floor(l);a[0]=m,a[1]=g,s[0]=n,s[1]=t,J()}function L(e){if(G.pencil)return;const n=e.touches[0],t=n.clientX,o=n.clientY;var i;(i=document.createElement("div")).id="fullscreenDiv",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0, 0, 0, 0.1)",i.style.zIndex="0",document.body.appendChild(i),C({pageX:t,pageY:o})}async function A(){await f(a("canvasIdent"),a("view")),pixelPlanetEvents.addListener("setviewcoordinates",(e=>G.viewCords=e)),document.addEventListener("mousemove",J),G.Canvass[1][0].onmousedown=C,G.mobile&&(document.getElementsByClassName("viewport")[0].addEventListener("touchstart",k),document.getElementsByClassName("viewport")[0].addEventListener("touchmove",k),document.addEventListener("touchmove",k),G.Canvass[1][0].addEventListener("touchstart",L)),document.addEventListener("keydown",g)}let I,_=new OffscreenCanvas(0,0),P=_.getContext("2d",{willReadFrequently:!0});class M{constructor(e,n,t,o,i,a,s){const r=document.createElement("canvas");r.width=i,r.height=a,this.name=e,this.data=s,this.x=n,this.y=t,this.width=i,this.height=a,this.errors=r,this.chunks=[],this.ctxErr=this.errors.getContext("2d"),_.width=this.width,_.height=this.height,P.clearRect(0,0,this.width,this.height),P.drawImage(this.data,0,0),this.RealData=P.getImageData(0,0,this.width,this.height).data,this.errors.style="width: 100%; height: 21.8vw; image-rendering: pixelated;"}GetImageData(){return this.RealData}GetIndex(e,n){return e<0?e=0:e>this.width&&(e=this.width),n<0?n=0:n>this.height&&(n=this.height),this.width*n+e}GetPixColorData(e){return Array.from(Array(4),((n,t)=>this.RealData[4*e+t]))}SetPixdata(e,n,t){this.ctxErr.fillStyle=t,this.ctxErr.fillRect(e,n,1,1)}ChekAndSet(e,n,t,o,i){const a=this.GetPixColorData(this.GetIndex(e,n));0!=a[3]&&(a[0]>t-40&&a[1]===o&&a[2]===i?this.SetPixdata(e,n,"rgba(0, 50, 0, 255)"):this.SetPixdata(e,n,"rgba(255, 0, 0, 255)"))}}class T{constructor(e){this.TestEvent=new Event("Test"),this.renderCords,this.images=[],this.Templates=null,this.canvasIdent=null,this.Canvass=null==e?[]:e,this.loadNewImages=!1,this.OverLayStatus="true"===localStorage.getItem("OverLayStatus")||!1,this.Errors="true"===localStorage.getItem("Errors")||!1,this.AutoColor="true"===localStorage.getItem("AutoColor")||!1,this.glow="true"===localStorage.getItem("glow")||!1,this.LastRadiusCheck=[],this.Radius=1,this.mobile=/Mobi|Android/i.test(navigator.userAgent),this.CheckRadius=(this.mobile,1/0),this.viewCords=[],this.TouchCords=[],this.RealTouchCords=[],this.Scale=1,this.oldCords=[],this.pencilTimeOut=!0,this.pencil=!1,this.fraction=localStorage.getItem("fraction")?localStorage.getItem("fraction"):"snowyaaaa",this.activData={},this.lastActivImage=null,this.ActivImageIsChanging=!1,this.CanvasMid=null,this.SaveObjectMid(),this.reset=function(){console.log("reinitializing"),G=new T(G.Canvass),G.canvasIdent=a("canvasIdent"),A()}}addImages(e){this.images.push(e),window.dispatchEvent(this.TestEvent)}SaveObjectMid(){let e=[256,256];0!=this.Canvass.length?e=[this.Canvass[0][0].width,this.Canvass[0][0].height]:null!==localStorage.getItem("size")&&(e=localStorage.getItem("size").split(",").map(Number)),this.CanvasMid=e.map((e=>e/2))}}function O(e,n){e.forEach(((e,n)=>{let t=e.data;t.className="item";let o=function(e,n){let t=document.createElement(e);for(let e in n)t.setAttribute(e,n[e]);return document.querySelector(".scrollable-content").append(t),t}("a",{class:"position",href:document.location.href.split(",")[0]+","+Math.round(e.x+e.width/2)+","+Math.round(e.y+e.height/2)+",0"});const i=document.createElement("p");i.textContent=e.name.split(".")[0],i.className="itemText",o.appendChild(i),o.appendChild(t)}))}function B(e,n){const t=document.getElementById("custom_item_container"),o=document.createElement("div");o.setAttribute("class","custom_item"),o.setAttribute("id",e);const i=document.createElement("div");i.setAttribute("class","link_container");const a=document.createElement("div");a.setAttribute("class","custom_item_text_div");const s=document.createElement("a");s.textContent=n.name,s.href=`${window.location.href.split(",")[0]},${n.position.x},${n.position.y},40`,i.appendChild(a),a.appendChild(s);const r=document.createElement("div");r.setAttribute("class","button_container");const l=document.createElement("button");l.setAttribute("class","delete_button"),l.textContent="delete",l.addEventListener("click",(function(){localStorage.removeItem(e),t.removeChild(o)})),r.appendChild(l),o.appendChild(i),o.appendChild(r),t.appendChild(o)}function R(){var e,n;(e=document.createElement("style")).textContent="\n    .container {\n      position: relative;\n    }\n\n    .top_content{\n        padding: 1vw;\n    }\n\n    .hidden-element {\n      position: absolute;\n      left: calc((50vw + 20px) * -1);\n      width: calc(50vw + 20px);\n      height: 100vh;\n      background-color: rgba(0, 0, 0, 0.8);\n      transition: all 0.5s ease;\n      overflow: auto;\n      z-index: 6;\n    }\n\n    .scrollable-content {\n      margin-top: 13vh;\n      padding: 1vh;\n      display: flex;\n      flex-wrap: wrap;\n      justify-content: space-between;\n    }\n\n    .item{\n      width:  12vw;\n      height: 12vw;\n      image-rendering: crisp-edges;\n      image-rendering: pixelated;\n    }\n    \n    .hidden-btn {\n      top: 25dvh;\n      z-index: 1;\n      position: absolute;\n      left: 0%;\n      background-color: lightblue;\n      transition: all 0.5s ease;\n    }\n\n    .show-menu {\n      left: 0;\n    }\n\n    .show-btn {\n      left: calc(50vw + 20px);\n    }\n\n    .toggle-btn {\n      width: 20px;\n      height: 50vh;\n      position: absolute;\n      background-color: black;\n      color: white;\n      border: none;\n      padding: 20px;\n      cursor: pointer;\n      z-index: 0;\n      box-shadow: 20px 0px 20px -11px rgb(0 123 255);\n\n      writing-mode: vertical-rl;\n      text-orientation: mixed;\n\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    /* \u0421\u043a\u0440\u044b\u0442\u044c \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u044b\u0435 \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 */\n    .hidden-element::-webkit-scrollbar {\n      display: none;\n    }\n\n    /* \u0421\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0442\u0440\u0435\u043a\u0430 \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 */\n    .hidden-element::-webkit-scrollbar-track {\n      background-color: #f1f1f1;\n    }\n\n    /* \u0421\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 */\n    .hidden-element::-webkit-scrollbar-thumb {\n      background-color: #888;\n      border-radius: 10px;\n    }\n\n    /* \u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0446\u0432\u0435\u0442\u0430 \u043f\u043e\u043b\u043e\u0441\u044b \u043f\u0440\u043e\u043a\u0440\u0443\u0442\u043a\u0438 \u043f\u0440\u0438 \u043d\u0430\u0432\u0435\u0434\u0435\u043d\u0438\u0438 */\n    .hidden-element::-webkit-scrollbar-thumb:hover {\n      background-color: #555;\n    }\n\n    .position{\n      display: block;\n      background-color: black;\n      margin-bottom: 1dvh;\n      white-space: nowrap; /* \u0417\u0430\u043f\u0440\u0435\u0442 \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u0442\u0435\u043a\u0441\u0442\u0430 \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 */\n      overflow: hidden; /* \u0421\u043a\u0440\u044b\u0442\u0438\u0435 \u0447\u0430\u0441\u0442\u0438 \u0442\u0435\u043a\u0441\u0442\u0430, \u0432\u044b\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u0437\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 */\n      text-overflow: ellipsis; /* \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u043d\u043e\u0433\u043e\u0442\u043e\u0447\u0438\u044f \u0432 \u043a\u043e\u043d\u0446\u0435 \u0442\u0435\u043a\u0441\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b\u0445\u043e\u0434\u0438\u0442 \u0437\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 */\n      transition: all 0.5s ease;\n      overflow: hidden;\n      width:  12vw;\n      height: 12vw;\n      display: block;\n    }\n\n    .itemText{\n      overflow: hidden;\n      position: absolute;\n      background-color: black;\n      width:  12vw;\n      margin: 0;\n      text-align: center;\n      border-bottom: solid;\n      border-bottom-width: 1px;\n    }\n\n\n    .inputs_text{\n      box-shadow: inset cornflowerblue 0 0px 0px 1px;\n      background-color: black;\n      color: white;\n      text-align: center;\n      padding: 0;\n      border: none;\n      width: 100%;\n      height: 5vh;\n    }\n    .inputs_text_part{\n      border-color: cornflowerblue;\n      background-color: black;\n      color: white;\n      text-align: center;\n      width: 50%;\n      height: 5vh;\n    }\n    .custom_points{\n      display: flex;\n    }\n\n\n\n    #inputs_buton{\n      background-color: springgreen;\n      margin-top: 2vh;\n      width: 100%;\n      height: 5vh;\n    }\n\n    .custom_item_text_div{\n      width: 80%;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n\n      .custom_item {\n        border: solid;\n        height: 5vh;\n        width: calc(50% - 7px);\n        display: flex;\n        border-width: 1px;\n        text-align: center;\n        background-color: black;\n        color: #327bba;\n        margin-bottom: 5px;\n      }\n\n\n\n      #custom_item_container{\n          padding: 10px;\n          display: flex;\n          flex-wrap: wrap;\n          justify-content: space-between;\n        }\n\n\n\n    @media (max-width: 599px) {\n      .itemText{\n        overflow: hidden;\n        position: absolute;\n        background-color: black;\n        width:  18vw;\n        margin: 0;\n        text-align: center;\n        border-bottom: solid;\n        border-bottom-width: 1px;\n      }\n      .scrollable-content {\n        padding: 3vh;\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: space-between;\n        }\n\n        .item{\n        width:  18vw;\n        height: 18vw;\n        image-rendering: crisp-edges;\n        image-rendering: pixelated;\n      }\n\n      .position{\n        display: block;\n        background-color: black;\n        margin-bottom: 1dvh;\n        white-space: nowrap; /* \u0417\u0430\u043f\u0440\u0435\u0442 \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u0430 \u0442\u0435\u043a\u0441\u0442\u0430 \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 */\n        overflow: hidden; /* \u0421\u043a\u0440\u044b\u0442\u0438\u0435 \u0447\u0430\u0441\u0442\u0438 \u0442\u0435\u043a\u0441\u0442\u0430, \u0432\u044b\u0445\u043e\u0434\u044f\u0449\u0435\u0433\u043e \u0437\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 */\n        text-overflow: ellipsis; /* \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u043d\u043e\u0433\u043e\u0442\u043e\u0447\u0438\u044f \u0432 \u043a\u043e\u043d\u0446\u0435 \u0442\u0435\u043a\u0441\u0442\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b\u0445\u043e\u0434\u0438\u0442 \u0437\u0430 \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 */\n        transition: all 0.5s ease;\n        overflow: hidden;\n        width:  18vw;\n        height: 18vw;\n        display: block;\n      }\n\n      .custom_item {\n          border: solid;\n          height: 5vh;\n          width: calc(100%);\n          display: flex;\n          border-width: 1px;\n          text-align: center;\n          background-color: black;\n          color: #327bba;\n          margin-bottom: 5px;\n      }\n      #custom_item_container {\n        padding: 10px;\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: space-between;\n        flex-direction: column;\n      }\n    }\n\n\n\n\n\n  \n\n    .link_container {\n         overflow: hidden;\n        display: flex;\n        width: 75%;\n        align-items: center;\n        justify-content: space-evenly;\n    }\n\n    .button_container {\n        width: 25%;\n        background-color: red;\n        display: flex;\n        background-color: red;\n        align-items: center;\n        justify-content: space-evenly;\n    }\n\n    .delete_button {\n            background-color: #ff000000;\n            border: none;\n        height: 100%;\n        width: 100%;\n    }\n\n\n\n\n\n\n\n.fractions_Lable_div{\n  display: flex;\n    background-color: black;\n    color: cornflowerblue;\n    width: 50%;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    border: solid;\n    border-width: 1px;\n}\n\n.fractions_Lable{\n    width: 85%;\n    text-align: center;\n}\n\n.fractions{\n    font-size: 17px;\n    text-align: center;\n    color: black;\n    width: 50%;\n    background-color: deepskyblue;\n    border-color: cornflowerblue;\n}\n\n.fraction_box{   \n    height: 5vh;\n    display: flex;\n    flex-direction: row;\n    margin-bottom: 2vh;\n}\n\n\n\n\n  ",document.head.appendChild(e),(n=document.createElement("div")).classList.add("container"),n.innerHTML='\n    <button class="toggle-btn hidden-btn"> \u2206 - \u2207 </button>\n    <div class="hidden-element">\n        \n\n          <div class = "top_content">\n              <div class = "fraction_box">\n                <div class = "fractions_Lable_div" >\n                  <label class = "fractions_Lable"for="fractions">\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0440\u0430\u043a\u0446\u0438\u044e</label>\n                </div>\n              \n                <select class = "fractions" id="fractions" name="fractions">\n                </select>\n              </div>\n\n\n                <hr style="\n                background-color: black;\n                color: black;\n                border-color: cornflowerblue;\n                ">\n\n\n                <div>\n                    <label for="name"></label>\n                    <input class="inputs_text" type="text" id="name" placeholder="Enter name">\n                </div>\n                <div class="custom_points">\n                    <label for="position"></label>\n                    <input class="inputs_text_part" type="number" id="x" placeholder="x">\n                    <input class="inputs_text_part" type="number" id="y" placeholder="y">\n                </div>\n                <button id="inputs_buton">Save</button>\n\n                <hr style="\n                    background-color: black;\n                    color: black;\n                    border-color: cornflowerblue;\n                ">\n                <div id="custom_item_container">\n                \n                </div>\n                    \n\n                <hr style="\n                background-color: black;\n                color: black;\n                border-color: cornflowerblue;\n                ">\n          </div>\n        <div class="scrollable-content">\n\n       </div>\n    </div>\n  ',document.body.appendChild(n),async function(){const e=document.getElementById("fractions");I=await U(p([104,116,116,112,115,58,47,47,114,97,119,46,103,105,116,104,117,98,117,115,101,114,99,111,110,116,101,110,116,46,99,111,109,47,84,104,101,69,108,100,101,114,70,97,108,108,111,117,116,115,47,119,119,98,116,112,47,114,101,102,115,47,104,101,97,100,115,47,109,97,105,110,47,80,80,47,102,114,97,99,116,105,111,110,46,106,115,111,110])),I.fractions.forEach(((n,t)=>{const o=document.createElement("option");o.setAttribute("value",t),o.textContent=n.fraction,G.fraction==n.name&&o.setAttribute("selected","selected"),e.appendChild(o)}))}(),document.getElementById("fractions").addEventListener("change",(e=>{const n=e.target.value;G.fraction=I.fractions[n].name,localStorage.setItem("fraction",G.fraction),G.reset()})),document.getElementById("inputs_buton").addEventListener("click",(function(){const e=document.getElementById("name").value,n=document.getElementById("x").value,t=document.getElementById("y").value;if(e&&n&&t){const o="id-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),i={name:e,position:{x:n,y:t}};localStorage.setItem(o,JSON.stringify(i)),B(o,i),document.getElementById("name").value=""}else alert("Please fill out all fields.")})),document.querySelector(".toggle-btn").addEventListener("click",(function(){document.querySelector(".hidden-element").classList.toggle("show-menu"),document.querySelector(".toggle-btn").classList.toggle("show-btn"),"show-menu"==document.querySelector(".hidden-element").classList[1]?setTimeout((()=>{document.getElementById("x").value=window.location.hash.split(",")[1],document.getElementById("y").value=window.location.hash.split(",")[2];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n.startsWith("id-")){B(n,JSON.parse(localStorage.getItem(n)))}}O(G.images,G.mobile)}),550):function(){let e=document.querySelector(".scrollable-content");for(;e.firstChild;)e.removeChild(e.firstChild);for(e=document.getElementById("custom_item_container");e.firstChild;)e.removeChild(e.firstChild)}()}))}function z(){const e=document.getElementById("menu");e.classList.contains("hidden")||(e.classList.toggle("hidden"),setTimeout((()=>{e.style.display="none"}),300))}function D(){var e;(e=document.createElement("style")).textContent="\n  #menu-toggle {\n    position: fixed;\n    top: 16px;\n    left: 35vw;\n    z-index: 5;\n    width: 30vw;\n    height: 38px;\n    color: white;\n    background-color: #000000f5;\n    border: 2px solid rgb(0 0 0);\n    box-shadow: 0px -5px 20px rgb(0 123 255);\n    transition: all 0.4s ease-in-out;\n  }\n\n  #menu-toggle:hover {\n    background-color: #00336acc;\n  }\n\n  #menu {\n    position: fixed;\n    top: 54px;\n    left: 35vw;\n    width: calc(30vw - 4px);\n    border: 2px solid black;\n    /* box-shadow: 0px 9px 20px rgb(0 123 255); */\n    z-index: 9998;\n    overflow: hidden;\n    opacity: 0;\n    display: none;\n    transition: all 0.2s ease-in-out;\n    height: 0;\n    flex-wrap: wrap;\n    background-color: #00000063;\n  }\n\n  #menu.hidden {\n      opacity: 0;\n      height: 0;\n  }\n@media (max-width: 599px) {\n  #menu{\n    position: fixed;\n    top: 54px;\n    left: 35vw;\n    width: calc(30vw - 4px);\n    border: 2px solid black;\n    /* box-shadow: 0px 9px 20px rgb(0 123 255); */\n    z-index: 9998;\n    overflow: hidden;\n    opacity: 0;\n    display: none;\n    transition: all 0.2s ease-in-out;\n    height: 0;\n    flex-wrap: wrap;\n    background-color: #00000063;\n    flex-direction: column;\n  }\n  #menu:not(.hidden) {\n    opacity: 1;\n    height: 50vh;\n  }\n}\n\n@media (min-width: 600px) {\n  #menu:not(.hidden) {\n    opacity: 1;\n    height: 13vh;\n  }\n}\n  .map_button {\n    background-color: #0506077d;;\n    color: #fff;\n    font-size: 16px;\n    border: solid;\n    border-color: black;\n    cursor: pointer;\n    flex-basis: calc(25%);\n    flex-grow: 0;\n    overflow: hidden;\n    transition: all 0.2s ease-in-out;\n  }\n\n  .cooldownbox{\n    top: 59px;\n    left: calc(44vw - 1px);\n    visibility: visible;\n    opacity: 0;\n    width: 85px;\n    margin-left: 0;\n    margin-right: 0;\n    padding: 0;\n  }\n\n  .notifybox {\n    opacity: 0;\n    top: 62px;\n    left: 85px;\n    visibility: visible;\n  }\n\n  .on {\n    background-color: #007fff82;\n  }\n\n  #historyselectfloat {\n    position: fixed;\n    top: 57px;\n    left: 0;\n    right: 0;\n    z-index: 2;\n}\n  ",document.head.appendChild(e),function(){try{var e=document.createElement("div");e.classList.add("container"),e.innerHTML=`\n    <button id="menu-toggle">\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u043c\u0435\u043d\u044e</button>\n    <div id="menu" class="hidden">\n        <button class="map_button MAPcolor ${"true"==localStorage.getItem("AutoColor")?"on":""}">Auto Color</button>\n        <button class="map_button MAPerr ${"true"==localStorage.getItem("Errors")?"on":""}">Detector</button>\n        <button class="map_button MAPoverlay ${"true"==localStorage.getItem("OverLayStatus")?"on":""}">Overlay</button>\n        <button class="map_button MAPglow ${"true"==localStorage.getItem("glow")?"on":""}">Glow</button>\n    </div>\n    `,document.body.appendChild(e)}catch(e){alert(e+"in LoadHTML"),console.error(e)}}(),document.getElementsByClassName("viewport")[0].addEventListener("mousemove",z),document.getElementById("menu-toggle").addEventListener("click",(()=>{!function(){const e=document.getElementById("menu");e.style.display="flex",setTimeout((()=>{e.classList.toggle("hidden"),e.classList.contains("hidden")&&setTimeout((()=>{e.style.display="none"}),300)}),10)}()}));document.querySelectorAll(".map_button").forEach((e=>{e.addEventListener("click",(function(){const e=this.classList[1];switch(console.log(`\u041a\u043d\u043e\u043f\u043a\u0430 \u0441 \u043a\u043b\u0430\u0441\u0441\u043e\u043c ${e} \u0431\u044b\u043b\u0430 \u043d\u0430\u0436\u0430\u0442\u0430`),e){case"MAPcolor":G.AutoColor=!G.AutoColor,localStorage.setItem("AutoColor",G.AutoColor),document.getElementsByClassName("MAPcolor")[0].classList.toggle("on");break;case"MAPerr":G.Errors=!G.Errors,localStorage.setItem("Errors",G.Errors),document.getElementsByClassName("MAPerr")[0].classList.toggle("on");break;case"MAPoverlay":!function(){let e=localStorage.getItem("size").split(",")?localStorage.getItem("size").split(","):[256,256],n=0,t=0;G.OverLayStatus=!G.OverLayStatus,localStorage.setItem("OverLayStatus",G.OverLayStatus),document.getElementsByClassName("MAPoverlay")[0].classList.toggle("on"),G.OverLayStatus?(n=window.innerWidth,t=window.innerHeight):(n=e[0],t=e[1]),G.Canvass.forEach((e=>{e[0].classList.toggle("notClickable"),e[0].width=n,e[0].height=t,e[1].imageSmoothingEnabled=!1}))}(),G.SaveObjectMid();break;case"MAPglow":!function(){const e=document.getElementById("cal"),n=!e.classList.contains("glow");e.classList.toggle("glow"),localStorage.setItem("glow",n),document.getElementsByClassName("MAPglow")[0].classList.toggle("on")}()}}))}))}function N(){var e;(e=document.createElement("style")).textContent="\n#Pencil{\n  width: 40px;\n}\n\n  .ModulPencil{\n    width: 40px;\n    z-index: 6;\n    position: relative;\n    top: calc(100dvh - 60px);\n    left: calc(50vw - 25px);\n  }\n\n  .on {\n    background-color: #007fff82 !important;\n  }\n\n  .Pencil{\n    box-shadow: 0px 0px 20px 2px rgb(0 123 255);\n    padding: 5px;\n    width: 40px;\n    height: 40px;\n    background-color: black;\n  }\n\n  ",document.head.appendChild(e),function(){try{var e=document.createElement("div");e.classList.add("ModulPencil"),e.innerHTML='\n    <div id="Pencil" class="Pencil">\n      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVR4nO3VMUoDQRiG4QVPkD5NBBurlG7jbTyAlaVexSuk0Uob8QRaeADFdtUi3SMLs6hhNZuIsz84L0z3w7x8/zdMVRUK/wzMcYtXXGJWRQE1Gl95xn4EuWmPXMcj9iJInn0j2EnOoktejNG5egPJl9xyTTpDJW9yy3UMkWxn5mPIdbzhsGf+JM0fjCm3LslpBLkfk4wil1/S5nIida6PIleV5LalJLctJbnfgGPcG07T99/+OXgK80P0gUVYuRachpVrwW6SXKysu8neOewMmLkb80Gcr1tZet11PquPiydYhuhVHzgKVf5VcPVJcJnWvbaT2cADrlOSk3w3FwpVSN4BObvo/VLm6/0AAAAASUVORK5CYII=">\n    </div>\n    ',document.body.appendChild(e)}catch(e){alert(e+"in LoadHTML"),console.error(e)}}();const n=document.getElementById("Pencil");n.onclick=()=>{var e;n.classList.contains("on")?(n.classList.remove("on"),document.getElementById("pen").remove(),G.pencil=!1):(n.classList.add("on"),(e=document.createElement("div")).id="pen",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0)",e.style.zIndex="0",document.body.appendChild(e),G.pencil=!0)}}let j=["mine","cal"],X=null,G=new T,Y=[];function W(e,n){console.error(e.message+"  ||--\x3e "+n),alert(e+"  ||--\x3e "+n)}function V(e,n){console.warn(e.message+"  ||--\x3e "+n)}async function H(e,n){let t=document.createElement(e);for(let e in n)t[e]=n[e];document.body.append(t)}async function U(e){try{return new Promise((n=>{fetch(e).then((e=>{n(e.json())}))}))}catch(e){W(e,"GetTeampletList")}}function $(){return G.Scale}async function q(){if(!G.images||!G.Canvass||!G.renderCords)return void requestAnimationFrame(q);const[e,n]=[G.Canvass[0],G.Canvass[1]],[t,o]=[e[1],n[1]];t.clearRect(0,0,e[0].width,e[0].height),o.clearRect(0,0,n[0].width,n[0].height),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,e[0].width,e[0].height);const i=G.images,a=G.renderCords,s=$(),r=G.OverLayStatus,c=G.CanvasMid,d=(e,n,t,o,i)=>{const l=t.map(((e,n)=>{const t=(e-a[n])*s+c[n];return r?t:Math.round(t)-s/2}));e.drawImage(n,...l,o*s,i*s)};i.forEach((({data:e,errors:n,x:i,y:a,width:s,height:r})=>{if(!e)return;const l=[i,a];d(t,e,l,s,r),G.Errors&&n&&d(o,n,l,s,r)}));const u=(n[0].width-G.Scale)/2,h=(n[0].height-G.Scale)/2;let m=await async function(e){const n=await l();return n&&n.length===e.length&&G.OverLayStatus?n.map(((n,t)=>(e[t]-n)*G.Scale-G.Scale/2)):[0,0]}(a);o.lineWidth=3,o.strokeStyle="rgba(0, 123, 255, 1)",o.strokeRect(u-m[0],h-m[1],G.Scale,G.Scale),o.strokeStyle="rgba(0, 0, 0 ,1)",o.strokeRect(u-m[0]+2,h-m[1]+2,G.Scale-4,G.Scale-4),t.lineWidth=3,t.strokeStyle="rgba(0, 123, 255, 1)",t.strokeRect(u-m[0],h-m[1],G.Scale,G.Scale),t.strokeStyle="rgba(0, 0, 0 ,1)",t.strokeRect(u-m[0]+2,h-m[1]+2,G.Scale-4,G.Scale-4),requestAnimationFrame(q)}async function J(){try{G.renderCords=G.OverLayStatus||G.mobile?G.viewCords:await l();let e=await n(G.images,G.renderCords);if(0==e.length)return;let t=e[0];if(G.Errors&&G.Scale>=.2)for(let c of e)d(c,G.renderCords);const o=await l();if(G.pencilTimeOut)if(G.pencil)G.pencilTimeOut=!1,a(1,t);else{if(!(e.length>0))return;i(t)}async function i(e,n,t){G.AutoColor&&G.Scale>1.2&&(o[0]==G.oldCords[0]&&o[1]==G.oldCords[1]||(X=o,s().getState().gui.mute||r({type:"s/TGL_MUTE"}),null!=n&&null!=t||m(e.GetPixColorData(e.GetIndex(o[0]-e.x,o[1]-e.y)))))}function a(e,n){for(let t=-e;t<=e;t++)for(let i=-e;i<=e;i++)if(t*t+i*i<=e*e){if(0!=n.length){const e=n.GetPixColorData(n.GetIndex(o[0]-n.x+t,o[1]-n.y+i));console.log(e),m(e)}h(G.RealTouchCords[0]+t*G.Scale,G.RealTouchCords[1]+i*G.Scale)}setTimeout((()=>{G.pencilTimeOut=!0}),50)}}catch(u){console.error(u),W(u,"DrawAllTemp")}}window.pixelPlanetEvents.addListener("setscale",((e,n)=>{G.Scale=e,J()})),window.registerPixelUpdates(((e,t,o)=>async function(e,t,o){const i=await l(),s=a("canvasSize")>>1,r=a("palette").rgb,c=await n(G.images,i);for(let n of c)o.forEach(((i,a)=>{u(n,e,t,o[a],s,r)}));J()}(e,t,o))),setTimeout((async()=>{console.log("Timeout completed, starting initialization"),async function(){console.log("Start function initiated"),localStorage.size||localStorage.setItem("size",[500,300]);try{await async function(){try{const e=localStorage.getItem("size").split(",")?localStorage.getItem("size").split(","):[256,256];for(let n in j)b(j[n],...e),G.Canvass[n][1].imageSmoothingEnabled=!1;G.SaveObjectMid()}catch(e){W(e,"crateAllCanvass")}}(),console.log("Canvas created successfully")}catch(e){return void W(e,"crateAllCanvass")}try{A(),requestAnimationFrame(q),console.log("Work function executed")}catch(e){return void W(e,"work")}try{R(),D(),G.mobile&&N(),console.log("Modules started")}catch(e){return void W(e,"Module start")}const e=document.createElement("style");e.innerHTML="\n            @keyframes blink {\n                0% { opacity: 0.0; }\n                50% { opacity: 1.0; }\n                100% { opacity: 0.0; }\n            }\n            #mine { box-shadow: -1px 1px 20px 0 rgb(0 123 255); z-index: -1; }\n            .glow { animation: blink 5s infinite; }\n            #mine:not(.notClickable) { border-style: unset; border-width: 1px; }\n            #cal:not(.notClickable) { border-style: unset; border-width: 1px; z-index: -1; }\n            .notClickable { pointer-events: none; opacity: 0.8; border: none; box-shadow: none; }\n        ",document.head.appendChild(e),console.log("Styles added"),G.canvasIdent=a("canvasIdent"),G.Scale=a("view")[2],setInterval((()=>{var e,n,t;e=G.viewCords,n=G.LastRadiusCheck,t=G.CheckRadius,(e[0]<n[0]-t||e[1]<n[1]-t||e[0]>n[0]+t||e[1]>n[1]+t)&&f(a("canvasIdent"),G.viewCords),G.canvasIdent!==a("canvasIdent")&&(console.log("Canvas state changed"),document.removeEventListener("mousemove",x),document.removeEventListener("mousemove",J),document.getElementsByClassName("viewport")[0].removeEventListener("touchmove",S),document.getElementsByClassName("viewport")[0].removeEventListener("touchstart",S),G.Canvass[G.Canvass.length-1][0].removeEventListener("touchstart",L),G.reset())}),1e3)}()}),1500)})();
